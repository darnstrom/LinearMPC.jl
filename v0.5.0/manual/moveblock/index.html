<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Move blocking  · LinearMPC.jl</title><meta name="title" content="Move blocking  · LinearMPC.jl"/><meta property="og:title" content="Move blocking  · LinearMPC.jl"/><meta property="twitter:title" content="Move blocking  · LinearMPC.jl"/><meta name="description" content="Documentation for LinearMPC.jl."/><meta property="og:description" content="Documentation for LinearMPC.jl."/><meta property="twitter:description" content="Documentation for LinearMPC.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LinearMPC.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../simple/">Simple example</a></li><li><a class="tocitem" href="../model/">Models</a></li><li><a class="tocitem" href="../objective/">Objective function</a></li><li><a class="tocitem" href="../constraints/">Constraints</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Beyond the basics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../prestab/">Prestabilization</a></li><li class="is-active"><a class="tocitem" href>Move blocking </a><ul class="internal"><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li><li><a class="tocitem" href="../reference_preview/">Reference Preview</a></li><li><a class="tocitem" href="../explicit/">Explict MPC</a></li><li><a class="tocitem" href="../hybrid/">Hybrid MPC</a></li></ul></li></ul></li><li><a class="tocitem" href="../../functions/">Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li><a class="is-disabled">Beyond the basics</a></li><li class="is-active"><a href>Move blocking </a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Move blocking </a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/darnstrom/LinearMPC.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/darnstrom/LinearMPC.jl/blob/main/docs/src/manual/moveblock.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="man_moveblock"><a class="docs-heading-anchor" href="#man_moveblock">Move Blocking</a><a id="man_moveblock-1"></a><a class="docs-heading-anchor-permalink" href="#man_moveblock" title="Permalink"></a></h1><p>A distinguishing characteristic of MPC compared with more classical control strategies such as PID or LQR is that it can be computationally demanding. For real-time applications, this can be a limiting factor.</p><p>One way of reducing the computational complexity is to reduce the number of decision variable in the MPC. This can be done by reducing the prediction horizon, but this can reduce the performance of the controller significantly (as is shown in the example below.) </p><p>Another way is to &quot;block&quot; some of the controls by holding them constant over more than one time step, which is known as &quot;move blocking&quot;<sup class="footnote-reference"><a id="citeref-Cagienard07" href="#footnote-Cagienard07">[Cagienard07]</a></sup>. If the blocks are selected wisely, the performance of a longer horizon may remain, while the decision variables are reduced significantly.  </p><p>In <strong>LinearMPC.jl</strong>, controls can be blocked with the function <code>move_block!</code>. The function takes in a vector that defines how the control decisions should be held. For example, one can hold the control for 3 time steps, then 2 time steps, then 1 time step, then 4 time steps with</p><pre><code class="language-julia hljs">move_block!(mpc,[3,2,1,4])</code></pre><div class="admonition is-info" id="Padding-of-move-blocks-c01793cede44e00a"><header class="admonition-header">Padding of move blocks<a class="admonition-anchor" href="#Padding-of-move-blocks-c01793cede44e00a" title="Permalink"></a></header><div class="admonition-body"><p>If the sum of the blocks add up to <em>less</em> than the prediction horizon, the last block will be extended to cover the entire horizon. For example, if <code>Np = 10</code>, the call <code>move_block!(mpc,[2,4])</code>  will result in the move blocks <code>[2,8]</code>.</p></div></div><div class="admonition is-info" id="Clipping-of-move-blocks-8099d53a146a58ec"><header class="admonition-header">Clipping of move blocks<a class="admonition-anchor" href="#Clipping-of-move-blocks-8099d53a146a58ec" title="Permalink"></a></header><div class="admonition-body"><p>If the sum of the blocks add up to <em>more</em> than the prediction horizon, the last blocks will be clipped until the remaining blocks add up to the prediction horizon. For example, if <code>Np = 10</code>, the call <code>move_block!(mpc,[2,4,6,3])</code> will result in the move blocks <code>[2,4,4]</code>.</p></div></div><p>One can also enter a set of evenly spaces blocks that covers the entire horizon. For example, if <code>Np=10</code>, the call <code>move_block!(mpc,2)</code> will result in the move blocks <code>[2,2,2,2,2]</code>.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>Consider the example of the control of an inverted pendulum on a cart, which is predefined as one of the examples in <strong>LinearMPC.jl</strong> and can be accessed with the call <code>mpc_examples</code>. We consider the case when we want the first output (the position of the cart) to reach a certain value (1 m to be specific.) Below we create three different MPC controllers with different prediction horizons and show the resulting step responses.   </p><pre><code class="language-julia hljs">using LinearMPC,Plots
tsolve, plt = zeros(3),plot();
for (k,Np) in  enumerate([100,75,50])
    mpc,_ = LinearMPC.mpc_examples(&quot;invpend&quot;,Np)
    tsolve[k] = @elapsed sim = LinearMPC.Simulation(mpc;r=[1,0],N=500);
    plot!(plt, sim,yids=[1],uids=[], color = k, label=&quot;Np = &quot;*string(Np))
end
plot!(plt,ylims=(-0.5,1.25))</code></pre><p><img src="../../assets/moveblock_horizon.svg" alt="simple_sim1" width=700 style="background-color:white; 
    border:20px solid white; display: block; margin-left: auto; margin-right: auto;"/></p><p>As can be seen, the higher the prediction horizon, the faster the setpoint is reached. (Note that for even lower values of the prediction horizon, the resulting closed-loop system becomes unstable.) The cost of the horizon can, however, be seen in the solve times, where the solve times are about four times slower for <span>$N_p = 100$</span> compared with <span>$N_p = 50$</span>. </p><p>To reduce the computation time, we consider three different move blocks. We consider the case of no move blocks (which an empty vector of move blocks encodes,) of evenly spaced move blocks <code>[1,1,1,1,1]</code> and a more dynamics set of move blocks <code>[1,1,5,10,10]</code>. For all of the cases, we consider a prediction horizon of <span>$N_p = 100$</span>. The resulting step responses are shown below.</p><pre><code class="language-julia hljs">using LinearMPC,Plots
mpc,_ = LinearMPC.mpc_examples(&quot;invpend&quot;,100)
tsolve, plt = zeros(3),plot();
move_blocks = [Int[], [1,1,1,1,1], [1,1,5,10,10]]
for (k,mb) in  enumerate(move_blocks)
    move_block!(mpc,mb)
    tsolve[k] = @elapsed sim = LinearMPC.Simulation(mpc;r=[1,0],N=500);
    plot!(plt, sim,yids=[1],uids=[], color = k, label=&quot;move block = &quot;*string(mb))
end
plot!(plt,ylims=(-0.5,1.25))</code></pre><p><img src="../../assets/moveblocks.svg" alt="simple_sim1" width=700 style="background-color:white; 
    border:20px solid white; display: block; margin-left: auto; margin-right: auto;"/></p><p>As can be seen, the adaptive move block almost performs as well as using no move blocks. The main difference is that when no move blocks are used, there are 100 decision variables, while for both the move blocks <code>[1,1,1,1,1]</code> and <code>[1,1,5,10,10]</code> there are only 5 decision variables. This can be seen in the solution times, where both of the move blocks leads to solution times that are about 6 times faster (note that the actual speedup is even higher due to some overhead from the simulation.)</p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-Cagienard07"><a class="tag is-link" href="#citeref-Cagienard07">Cagienard07</a>Cagienard, Raphael, et al. &quot;Move blocking strategies in receding horizon control.&quot; <em>Journal of Process Control</em> 17.6 (2007): 563-570.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../prestab/">« Prestabilization</a><a class="docs-footer-nextpage" href="../reference_preview/">Reference Preview »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 17 July 2025 11:43">Thursday 17 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
