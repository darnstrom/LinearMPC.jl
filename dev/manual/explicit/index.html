<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Explict MPC · LinearMPC.jl</title><meta name="title" content="Explict MPC · LinearMPC.jl"/><meta property="og:title" content="Explict MPC · LinearMPC.jl"/><meta property="twitter:title" content="Explict MPC · LinearMPC.jl"/><meta name="description" content="Documentation for LinearMPC.jl."/><meta property="og:description" content="Documentation for LinearMPC.jl."/><meta property="twitter:description" content="Documentation for LinearMPC.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LinearMPC.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../simple/">Simple example</a></li><li><a class="tocitem" href="../model/">Models</a></li><li><a class="tocitem" href="../objective/">Objective function</a></li><li><a class="tocitem" href="../constraints/">Constraints</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Beyond the basics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../prestab/">Prestabilization</a></li><li><a class="tocitem" href="../moveblock/">Move blocking </a></li><li><a class="tocitem" href="../reference_preview/">Reference Preview</a></li><li class="is-active"><a class="tocitem" href>Explict MPC</a><ul class="internal"><li><a class="tocitem" href="#Parameter-range"><span>Parameter range</span></a></li><li><a class="tocitem" href="#Computing-control"><span>Computing control</span></a></li><li><a class="tocitem" href="#Code-generation"><span>Code generation</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li><li><a class="tocitem" href="../hybrid/">Hybrid MPC</a></li></ul></li></ul></li><li><a class="tocitem" href="../../functions/">Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li><a class="is-disabled">Beyond the basics</a></li><li class="is-active"><a href>Explict MPC</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Explict MPC</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/darnstrom/LinearMPC.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/darnstrom/LinearMPC.jl/blob/main/docs/src/manual/explicit.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="man_empc"><a class="docs-heading-anchor" href="#man_empc">Explicit MPC</a><a id="man_empc-1"></a><a class="docs-heading-anchor-permalink" href="#man_empc" title="Permalink"></a></h1><p>The resulting control law from MPC is given implicitly in terms of a solution to an optimization problem. The solution to this optimization problem does, however, have a closed-form expression when the system to be controlled is linear and time-invariant system, and the constraints are polyhedral. More concretely, the control law is <em>piecewise affine</em> over <em>polyhedral regions</em><sup class="footnote-reference"><a id="citeref-Bemporad02" href="#footnote-Bemporad02">[Bemporad02]</a></sup>; that is, the optimal control action <span>$u^*$</span> is a pieacwise affine function of a parameter <span>$\theta$</span>, where <span>$\theta$</span> contains the state, set points, measurable disturbances, and previous control actions. Explicitly the optimal control action is of the form</p><p class="math-container">\[u^*(\theta) = K_i \theta + k_i,\quad \text{ if } \theta \in \Theta_i \triangleq \{\theta : A^{\theta}_i \theta \leq b^{\theta}_i\},\]</p><p>where the feedback gain <span>$K_i$</span> and offset <span>$k_i$</span> are defined for each <em>critical region</em> <span>$\Theta_i$</span>, which is defined by the matrix <span>$A^{\theta}_i$</span> and offset <span>$b^{\theta}_i$</span>.</p><p>In <em>explicit MPC</em> these feedbacks and regions are stored to be used online to find an optimal control action in a two step procedure:</p><ol><li>Find the index <span>$j$</span> for which <span>$\theta \in \Theta_j$</span></li><li>Apply the control action <span>$u = K_j \theta + k_j$</span></li></ol><p>If step 1 is done correctly, this can save a lot of computations, since an optimization solver does not have to be embedded. A drawback is, however, that the number of regions grows rapidly as the problem dimension increase, resulting in a significant memory footprint (since all feedbacks + regions needs to be stored in memory.)</p><p>Computing the explicit solution can be quite challenging in its own right. <strong>LinearMPC.jl</strong> make use of the state-of-the-art multi-parametric programming solver <a href="https://github.com/darnstrom/ParametricDAQP.jl/">ParametricDAQP.jl</a><sup class="footnote-reference"><a id="citeref-Arnstrom24" href="#footnote-Arnstrom24">[Arnstrom24]</a></sup></p><p>For a given MPC controller <code>mpc</code>, an explicit MPC controller can be created with </p><pre><code class="language-julia hljs">empc = LinearMPC.ExplicitMPC(mpc)</code></pre><p>The resulting critical regions can be found with <code>empc.solution.CRs</code>, where the field <code>Ath</code> and <code>bth</code> in a critical region define the region itself, and the field <code>z</code> gives the feedback. Specifically, <code>K  = z[1:end-1,:]&#39;</code> and <code>k=z[end,:]&#39;</code>, so the optimal control <code>u</code> can be computed for the parameter <code>θ</code> with <code>u=z&#39;*[θ;1]</code>. </p><h2 id="Parameter-range"><a class="docs-heading-anchor" href="#Parameter-range">Parameter range</a><a id="Parameter-range-1"></a><a class="docs-heading-anchor-permalink" href="#Parameter-range" title="Permalink"></a></h2><p>Running the code above gives the warning &quot;No paramter range defined&quot;. This is because we have not specified where in parameter space the solution should be computed. By default, a box with limits <span>$[-100,100]$</span> is used, but this might be too big or too small of a volume. Instead, users can provide a <code>ParameterRange</code> which defines where in parameter space the solution should be computed. For example  </p><pre><code class="nohighlight hljs">parameter_range = LinearMPC.ParameterRange(mpc)
parameter_range.xmin[:] .= -1
parameter_range.xmax[:] .=  1</code></pre><p>will consider states in the unit box. Similarly, one can modify the range for </p><ul><li><strong>references</strong> by modifying the field <code>rmin</code> and <code>rmax</code></li><li><strong>disturbances</strong> by modifying the field <code>dmin</code> and <code>dmax</code></li></ul><h2 id="Computing-control"><a class="docs-heading-anchor" href="#Computing-control">Computing control</a><a id="Computing-control-1"></a><a class="docs-heading-anchor-permalink" href="#Computing-control" title="Permalink"></a></h2><p>To efficiently compute a control action using explicit MPC controller, <strong>LinearMPC.jl</strong> constructs a  <em>binary search tree</em><sup class="footnote-reference"><a id="citeref-Tondel03" href="#footnote-Tondel03">[Tondel03]</a></sup>. This can be done with</p><pre><code class="language-julia hljs">LinearMPC.build_tree!(empc)</code></pre><p>A binary search tree will also be compuetd by passing the optional argument <code>buil_tree</code> to <code>EMPC</code>:  </p><pre><code class="language-julia hljs">empc = LinearMPC.ExplicitMPC(mpc;build_tree=true)</code></pre><p>When a binary search tree has been formed , a control can be computed, similar as for a normal <code>MPC</code> struct, with the function <code>compute_control</code>. Given a state <code>x</code> and setpoint <code>r</code>, the corresponding control is computed with </p><pre><code class="language-julia hljs">x = LinearMPC.compute_control(empc,x;r=r)</code></pre><h2 id="Code-generation"><a class="docs-heading-anchor" href="#Code-generation">Code generation</a><a id="Code-generation-1"></a><a class="docs-heading-anchor-permalink" href="#Code-generation" title="Permalink"></a></h2><p>C code for an explicit MPC controller can be generate with <code>codegen</code>. The call</p><pre><code class="nohighlight hljs">LinearMPC.codegen(empc;dir=&quot;code_dir&quot;)</code></pre><p>will generate C code in the directory <code>code_dir</code>.</p><p>The main function of interest is <code>mpc_compute_control(control, state, reference, disturbance)</code>. This function computes the optimal control given the current <code>state</code>, <code>reference</code>, and measured disturbances <code>disturbance</code>, which are all floating-point arrays. The optimal control is stored in the floating-point array <code>control</code>.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>To show some of the functionality, we consider he explicit MPC controller for control a DC servo motor, also considered as an example in the MATLAB MPC Toolbox <a href="https://se.mathworks.com/help/mpc/ug/explicit-mpc-control-of-dc-servomotor-with-constraint-on-unmeasured-output.html">here</a>. </p><p>This is an example that is available in <code>mpc_examples</code>, so a template for the MPC controller can be created with</p><pre><code class="language-julia hljs">using LinearMPC
mpc,para_range= LinearMPC.mpc_examples(&quot;dcmotor&quot;)</code></pre><p>Note that <code>mpc_examples</code> also provide a template for the parameter range. We do, however, want to ensure that the exlicit MPC controller is computed for <span>$|x_1| \leq 0.3$</span>  and <span>$|x_2| \leq 2$</span>, which we can ensure with</p><pre><code class="language-julia hljs">para_range.xmin[1:2] = -[0.3;2.0] 
para_range.xmax[1:2] = [0.3;2.0]</code></pre><p>Next, we compute an explicit controller with </p><pre><code class="language-julia hljs">empc = LinearMPC.ExplicitMPC(mpc;range=para_range)</code></pre><p>If we want to visualize a slice of the resulting polytopic partition, we can use the function <code>plot_regions</code>. This takes in the names of the parameters to be plotted as argument. We can also fix other parameter with optional arguments (which are by default fixed at 0.) If we, for example, want to plot a 2D-slice of the partition in the first and second state, when the reference is fixed at <span>$r=[0.5,0.0]$</span>, we run   </p><pre><code class="language-julia hljs">LinearMPC.plot_regions(empc,:x1,:x2,r=[0.5,0.0])</code></pre><p><img src="../../assets/exp_regions.svg" alt="simple_sim1" width=600 style="background-color:white; 
    border:20px solid white; display: block; margin-left: auto; margin-right: auto;"/></p><p>Similarly, if we want to visualize the feedback law, we can do that with <code>plot_feedback</code>, where one also has to enter the name of the input to plot (in this case <code>:u1</code>). </p><p>If we, for example, want to visualize the feedback for the first input for different <span>$x_1$</span> and <span>$x_2$</span>, when the reference is fixed at <span>$r=[0.5,0.0]$</span>, we run   </p><pre><code class="language-julia hljs">LinearMPC.plot_feedback(empc,:u1,:x1,:x2,r=[0.5,0.0])</code></pre><p><img src="../../assets/exp_feedback.svg" alt="simple_sim1" width=600 style="background-color:white; 
    border:20px solid white; display: block; margin-left: auto; margin-right: auto;"/></p><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-Bemporad02"><a class="tag is-link" href="#citeref-Bemporad02">Bemporad02</a>Bemporad, Alberto, et al. &quot;The explicit linear quadratic regulator for constrained systems.&quot; <em>Automatica</em> 38.1 (2002): 3-20.</li><li class="footnote" id="footnote-Arnstrom24"><a class="tag is-link" href="#citeref-Arnstrom24">Arnstrom24</a>Arnström, Daniel, and Axehill, Daniel &quot;A High-Performant Multi-Parametric Quadratic Programming Solver,&quot; 2024 <em>IEEE 63rd Conference on Decision and Control (CDC)</em>, Milan, Italy, 2024, pp. 303-308</li><li class="footnote" id="footnote-Tondel03"><a class="tag is-link" href="#citeref-Tondel03">Tondel03</a>Tøndel, Petter, Tor Arne Johansen, and Alberto Bemporad. &quot;Evaluation of piecewise affine control via binary search tree.&quot; <em>Automatica</em> 39.5 (2003): 945-950.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../reference_preview/">« Reference Preview</a><a class="docs-footer-nextpage" href="../hybrid/">Hybrid MPC »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 22 July 2025 16:09">Tuesday 22 July 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
