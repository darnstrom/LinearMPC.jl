<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Linear control cost · LinearMPC.jl</title><meta name="title" content="Linear control cost · LinearMPC.jl"/><meta property="og:title" content="Linear control cost · LinearMPC.jl"/><meta property="twitter:title" content="Linear control cost · LinearMPC.jl"/><meta name="description" content="Documentation for LinearMPC.jl."/><meta property="og:description" content="Documentation for LinearMPC.jl."/><meta property="twitter:description" content="Documentation for LinearMPC.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">LinearMPC.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><input class="collapse-toggle" id="menuitem-2-1" type="checkbox"/><label class="tocitem" for="menuitem-2-1"><span class="docs-label">Getting started</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../simple/">Simple example</a></li><li><a class="tocitem" href="../model/">Models</a></li><li><a class="tocitem" href="../objective/">Objective function</a></li><li><a class="tocitem" href="../constraints/">Constraints</a></li><li><a class="tocitem" href="../observer/">State observer</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox" checked/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">Beyond the basics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../prestab/">Prestabilization</a></li><li><a class="tocitem" href="../moveblock/">Move blocking </a></li><li><a class="tocitem" href="../reference_preview/">Reference Preview</a></li><li><a class="tocitem" href="../explicit/">Explict MPC</a></li><li><a class="tocitem" href="../hybrid/">Hybrid MPC</a></li><li><a class="tocitem" href="../robust/">Robust MPC</a></li><li class="is-active"><a class="tocitem" href>Linear control cost</a><ul class="internal"><li><a class="tocitem" href="#Example:-Heat-Pump-with-Time-Varying-Electricity-Prices"><span>Example: Heat Pump with Time-Varying Electricity Prices</span></a></li></ul></li><li><a class="tocitem" href="../solver/">Solver Settings</a></li></ul></li></ul></li><li><a class="tocitem" href="../../functions/">Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Manual</a></li><li><a class="is-disabled">Beyond the basics</a></li><li class="is-active"><a href>Linear control cost</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Linear control cost</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/darnstrom/LinearMPC.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/darnstrom/LinearMPC.jl/blob/main/docs/src/manual/linear_cost.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Linear-Cost"><a class="docs-heading-anchor" href="#Linear-Cost">Linear Cost</a><a id="Linear-Cost-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-Cost" title="Permalink"></a></h1><p>LinearMPC supports a linear cost term <span>$l_k^T u_k$</span> that penalizes control inputs, enabling economic MPC where control actions have time-varying costs. A typical application is heating or cooling systems where electricity prices vary throughout the day.</p><h2 id="Example:-Heat-Pump-with-Time-Varying-Electricity-Prices"><a class="docs-heading-anchor" href="#Example:-Heat-Pump-with-Time-Varying-Electricity-Prices">Example: Heat Pump with Time-Varying Electricity Prices</a><a id="Example:-Heat-Pump-with-Time-Varying-Electricity-Prices-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Heat-Pump-with-Time-Varying-Electricity-Prices" title="Permalink"></a></h2><p>This example demonstrates using linear cost to optimize heating while accounting for electricity price variations.</p><h3 id="Price-Generation"><a class="docs-heading-anchor" href="#Price-Generation">Price Generation</a><a id="Price-Generation-1"></a><a class="docs-heading-anchor-permalink" href="#Price-Generation" title="Permalink"></a></h3><p>First, we define a function to generate realistic electricity prices with daily patterns:</p><pre><code class="language-julia hljs">function generate_test_prices(n_days=7)
    n_per_day = 24
    n = n_days * n_per_day

    prices = zeros(n)

    for day in 1:n_days
        t = range(0, 24, length=n_per_day)

        daily_factor = 0.8 + 0.4 * rand()

        base = 0.5 .+ 0.2 * sin.(2π * (t .- 6) / 24)

        morning_shift = 8 + randn() * 0.5
        evening_shift = 18 + randn() * 0.5
        morning_peak = (0.4 + 0.2 * rand()) * exp.(-((t .- morning_shift) .^ 2) / 2)
        evening_peak = (0.3 + 0.2 * rand()) * exp.(-((t .- evening_shift) .^ 2) / 3)
        night_dip = -0.1 * exp.(-((t .- 3) .^ 2) / 4)

        day_prices = daily_factor * (base + morning_peak + evening_peak + night_dip)
        day_prices = day_prices .+ 0.05 * randn(n_per_day)

        idx_start = (day - 1) * n_per_day + 1
        idx_end = day * n_per_day
        prices[idx_start:idx_end] = day_prices
    end

    prices = max.(prices, 0.1)
    prices = 0.2 .+ 1.5 * (prices .- minimum(prices)) / (maximum(prices) - minimum(prices))

    return prices
end</code></pre><h3 id="Room-Temperature-Model"><a class="docs-heading-anchor" href="#Room-Temperature-Model">Room Temperature Model</a><a id="Room-Temperature-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Room-Temperature-Model" title="Permalink"></a></h3><p>We model a simple room heated by a heat pump. The temperature dynamics are first-order:</p><p class="math-container">\[T_{k+1} = a \cdot T_k + b \cdot u_k\]</p><p>where <span>$T$</span> is room temperature, <span>$u$</span> is heating power, <span>$a &lt; 1$</span> represents heat loss, and <span>$b$</span> is the heating efficiency.</p><pre><code class="language-julia hljs">using LinearMPC
using Random
Random.seed!(0)

# First-order temperature dynamics (discrete-time, 1 hour sampling)
a = 0.95  # Heat retention
b = 4.0   # Heating efficiency

A = [a;;]
B = [b;;]
C = [1.0;;]

Np = 24  # 24-hour prediction horizon

mpc = LinearMPC.MPC(A, B; C, Np=Np, Nc=Np)
set_bounds!(mpc; umin=[0.0], umax=[1.0])  # Heating power between 0 and 1
set_objective!(mpc; Q=[0.05]) # The linear cost is time varying, so we supply a cost trajectory first when using the controller

# Enable linear cost
mpc.settings.linear_cost = true
setup!(mpc)</code></pre><h3 id="Simulation"><a class="docs-heading-anchor" href="#Simulation">Simulation</a><a id="Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation" title="Permalink"></a></h3><p>We simulate 3 days of operation, maintaining a temperature setpoint while minimizing electricity cost:</p><pre><code class="language-julia hljs">N_sim = 72  # 3 days

# Generate electricity prices
prices = generate_test_prices(3)

# Reference temperature
r = fill(21.0, 1, N_sim)

# Linear cost is the electricity price (nu × N_sim)
l = prices&#39;

# Run simulation
sim = Simulation(mpc; x0=[18.0], N=N_sim, r, l)</code></pre><h3 id="Results"><a class="docs-heading-anchor" href="#Results">Results</a><a id="Results-1"></a><a class="docs-heading-anchor-permalink" href="#Results" title="Permalink"></a></h3><pre><code class="language-julia hljs">using Plots
plot(sim)</code></pre><img src="3f3b0b2f.svg" alt="Example block output"/><p>The controller pre-heats when electricity is cheap and reduces heating during expensive peak hours, while keeping the temperature close to the setpoint.</p><p>We can also visualize the electricity prices alongside the heating pattern:</p><pre><code class="language-julia hljs">p1 = plot(sim.us&#39;, label=&quot;Heating power&quot;, ylabel=&quot;Power&quot;)
p2 = plot(l&#39;, label=&quot;Electricity price&quot;, ylabel=&quot;Price&quot;, xlabel=&quot;Hour&quot;)
plot(p1, p2, layout=(2,1))</code></pre><img src="57852221.svg" alt="Example block output"/><p>Notice how heating tends to increase when prices are low (typically at night) and decrease during peak price periods. We can demonstrate this further by plotting the prices vs. the heating power, which should show an inverse relationship:</p><pre><code class="language-julia hljs">scatter(l&#39;, sim.us&#39;; xlabel=&quot;Electricity Price&quot;, ylabel=&quot;Heating Power&quot;, title=&quot;Heating Power vs. Electricity Price&quot;)</code></pre><img src="dca927c9.svg" alt="Example block output"/><h3 id="Conclusion"><a class="docs-heading-anchor" href="#Conclusion">Conclusion</a><a id="Conclusion-1"></a><a class="docs-heading-anchor-permalink" href="#Conclusion" title="Permalink"></a></h3><p>Using a linear cost in the MPC objective allows the controller to optimize heating actions based on time-varying electricity prices, leading to cost-effective operation while maintaining comfort.</p><p>The example can be extended in several directions</p><ul><li>Time varying reference temperature (e.g., lower at night)</li><li>Adding constraints on temperature (e.g., minimum temperature)</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../robust/">« Robust MPC</a><a class="docs-footer-nextpage" href="../solver/">Solver Settings »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 8 January 2026 20:14">Thursday 8 January 2026</span>. Using Julia version 1.12.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
